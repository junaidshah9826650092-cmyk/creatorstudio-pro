<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vitox AI | India's #1 Video Hosting & Sharing Platform</title>
    <meta name="description"
        content="Vitox AI is India's next-gen video platform. Upload, share, and discover amazing videos powered by AI. Join the community of creators today.">
    <meta name="keywords" content="video platform, video sharing, indian youtube alternative, vitox ai, ai video">
    <link rel="stylesheet" href="https://get.mavo.io/mavo.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://get.mavo.io/mavo.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body mv-app="youtube" mv-storage="local" mv-bar="none" class="dark-theme">

    <!-- Top Bar -->
    <header class="top-bar">
        <div class="header-left">
            <button class="icon-btn menu-btn" onclick="document.querySelector('.sidebar').classList.toggle('active')"><i
                    class="fas fa-bars"></i></button>
            <div class="logo">
                <i class="fas fa-bolt-lightning color-red"></i>
                <span>Vitox AI</span><span class="country-code">IN</span>
            </div>
        </div>

        <div class="header-center">
            <div class="search-container">
                <div class="search-box">
                    <input type="text" placeholder="Search">
                    <button class="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <button class="icon-btn mic-btn"><i class="fas fa-microphone"></i></button>
            </div>
        </div>

        <div class="header-right">
            <button class="btn-text" onclick="location.href='dashboard.html'" title="Creator Studio">
                <i class="fas fa-clapperboard"></i> Studio
            </button>
            <div id="login-container">
                <div id="g_id_onload"
                    data-client_id="392918089798-sqv6ro56e2lkdhu8jmh0j7mb1ka3lhbj.apps.googleusercontent.com"
                    data-context="signin" data-ux_mode="popup" data-callback="handleCredentialResponse"
                    data-auto_prompt="false">
                </div>
                <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="outline"
                    data-text="signin_with" data-size="medium" data-logo_alignment="left">
                </div>
            </div>
            <button class="icon-btn" mv-action="add(video)" title="Upload Video"><i class="fas fa-plus"></i></button>
            <button class="icon-btn"><i class="fas fa-bell"></i></button>
            <div class="user-avatar" id="user-avatar" property="currentUserAvatar" onclick="toggleUserMenu()"
                title="Account Options">?</div>

            <!-- Hidden User Menu -->
            <div id="user-menu"
                style="display: none; position: absolute; top: 56px; right: 16px; background: #282828; border: 1px solid #3f3f3f; border-radius: 8px; padding: 8px; z-index: 3000;">
                <button class="nav-item" onclick="logout()"
                    style="width: 100%; justify-content: start; background: transparent; border: none; padding: 8px 16px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </header>

    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active"><i class="fas fa-home"></i> <span>Home</span></a>
                <a href="#" class="nav-item"><i class="fas fa-play-circle"></i> <span>Shorts</span></a>
                <a href="#" class="nav-item"><i class="fas fa-layer-group"></i> <span>Subscriptions</span></a>
                <hr>
                <a href="#" class="nav-item"><i class="fas fa-video-slash"></i> <span>Library</span></a>
                <a href="#" class="nav-item"><i class="fas fa-history"></i> <span>History</span></a>
                <a href="#" class="nav-item"><i class="fas fa-clock"></i> <span>Watch later</span></a>
                <a href="#" class="nav-item"><i class="fas fa-thumbs-up"></i> <span>Liked videos</span></a>
            </nav>
        </aside>

        <!-- Content Area -->
        <main class="content">
            <!-- Categories -->
            <div class="categories-bar">
                <button class="chip active">All</button>
                <button class="chip">Music</button>
                <button class="chip">Gaming</button>
                <button class="chip">Live</button>
                <button class="chip">Tech</button>
                <button class="chip">News</button>
                <button class="chip">Comedy</button>
                <button class="chip">Education</button>
                <button class="chip">Recent</button>
            </div>

            <!-- Skeleton Loader (Visible during initial load) -->
            <div id="loading-shimmer">
                <div class="skeleton-card">
                    <div class="skeleton skeleton-thumbnail"></div>
                    <div style="display: flex; gap: 12px; margin-top: 12px;">
                        <div class="skeleton skeleton-avatar"></div>
                        <div style="flex: 1;">
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-text" style="width: 50%;"></div>
                        </div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton skeleton-thumbnail"></div>
                    <div style="display: flex; gap: 12px; margin-top: 12px;">
                        <div class="skeleton skeleton-avatar"></div>
                        <div style="flex: 1;">
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-text" style="width: 50%;"></div>
                        </div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton skeleton-thumbnail"></div>
                    <div style="display: flex; gap: 12px; margin-top: 12px;">
                        <div class="skeleton skeleton-avatar"></div>
                        <div style="flex: 1;">
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-text" style="width: 50%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Video Grid (Initially hidden) -->
            <div class="video-grid" style="display: none;">
                <!-- Video 1 -->
                <div property="video" mv-multiple class="video-card">
                    <div class="thumbnail-wrapper">
                        <img property="thumbnail"
                            src="https://images.unsplash.com/photo-1541807084-5c52b6b3adef?q=80&w=1000&auto=format&fit=crop"
                            alt="Thumbnail">
                        <span class="duration" property="duration">15:02</span>
                    </div>
                    <div class="video-info">
                        <div class="channel-avatar">
                            <img property="channelAvatar" src="https://i.pravatar.cc/100?u=tech" alt="">
                        </div>
                        <div class="text-info">
                            <h3 class="video-title" property="title">Building a YouTube Clone with Mavo</h3>
                            <p class="channel-name" property="channel">Code with Mavo <i
                                    class="fas fa-check-circle"></i></p>
                            <div class="meta-data">
                                <span property="views">45K</span> views • <span property="timestamp">1 day ago</span>
                            </div>
                        </div>
                        <button class="mv-ui mv-delete icon-btn-small" title="Delete video"><i
                                class="fas fa-trash"></i></button>
                    </div>
                </div>

                <!-- Video 2 -->
                <div property="video" mv-multiple class="video-card">
                    <div class="thumbnail-wrapper">
                        <img property="thumbnail"
                            src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=1000&auto=format&fit=crop"
                            alt="Thumbnail">
                        <span class="duration" property="duration">08:20</span>
                    </div>
                    <div class="video-info">
                        <div class="channel-avatar">
                            <img property="channelAvatar" src="https://i.pravatar.cc/100?u=design" alt="">
                        </div>
                        <div class="text-info">
                            <h3 class="video-title" property="title">Modern UI/UX Design Trends 2024</h3>
                            <p class="channel-name" property="channel">Design Mastery <i
                                    class="fas fa-check-circle"></i></p>
                            <div class="meta-data">
                                <span property="views">120K</span> views • <span property="timestamp">3 hours ago</span>
                            </div>
                        </div>
                        <button class="mv-ui mv-delete icon-btn-small" title="Delete video"><i
                                class="fas fa-trash"></i></button>
                    </div>
                </div>

                <!-- Video 3 -->
                <div property="video" mv-multiple class="video-card">
                    <div class="thumbnail-wrapper">
                        <img property="thumbnail"
                            src="https://images.unsplash.com/photo-1587620962725-abab7fe55159?q=80&w=1000&auto=format&fit=crop"
                            alt="Thumbnail">
                        <span class="duration" property="duration">22:15</span>
                    </div>
                    <div class="video-info">
                        <div class="channel-avatar">
                            <img property="channelAvatar" src="https://i.pravatar.cc/100?u=gaming" alt="">
                        </div>
                        <div class="text-info">
                            <h3 class="video-title" property="title">The Future of AI in Web Development</h3>
                            <p class="channel-name" property="channel">Tech Today <i class="fas fa-check-circle"></i>
                            </p>
                            <div class="meta-data">
                                <span property="views">890K</span> views • <span property="timestamp">5 hours ago</span>
                            </div>
                        </div>
                        <button class="mv-ui mv-delete icon-btn-small" title="Delete video"><i
                                class="fas fa-trash"></i></button>
                    </div>
                </div>
            </div>

            <!-- Empty State if no videos -->
            <div mv-if="count(video) == 0" class="empty-state">
                <i class="fas fa-video-slash"></i>
                <p>No videos found. Click "Create" to add one!</p>
            </div>
        </main>
    </div>



    <script>
        async function handleCredentialResponse(response) {
            const base64Url = response.credential.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const payload = JSON.parse(window.atob(base64));

            console.log("Syncing with Full Stack Backend...");

            // Sync with Python Backend
            try {
                const res = await fetch('/api/user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: payload.email,
                        name: payload.name,
                        picture: payload.picture
                    })
                });

                const dbUser = await res.json();

                // Save complete backend user profile
                localStorage.setItem('vitox_user', JSON.stringify(dbUser));

                updateLoginUI(dbUser);
                alert(`Welcome back, ${dbUser.name}!`);
            } catch (error) {
                console.error("Backend Sync Failed:", error);
                // Fallback to local only if server is down
                localStorage.setItem('vitox_user', JSON.stringify(payload));
                updateLoginUI(payload);
            }
        }

        function updateLoginUI(user) {
            if (user) {
                console.log("Updating UI for:", user.name);
                const loginContainer = document.getElementById('login-container');
                const avatar = document.getElementById('user-avatar');

                if (loginContainer) loginContainer.style.display = 'none';

                if (avatar) {
                    avatar.textContent = user.name.charAt(0).toUpperCase();
                    // Remove Mavo property temporarily to prevent overwrite
                    avatar.removeAttribute('property');

                    if (user.picture) {
                        avatar.style.backgroundImage = `url(${user.picture})`;
                        avatar.style.backgroundSize = 'cover';
                        avatar.style.backgroundPosition = 'center';
                        avatar.style.color = 'transparent';
                    }

                    // Show Admin Button if authorized
                    if (user.email === 'junaidshah78634@gmail.com') {
                        const headerRight = document.querySelector('.header-right');
                        if (!document.getElementById('admin-link-btn')) {
                            const adminBtn = document.createElement('button');
                            adminBtn.id = 'admin-link-btn';
                            adminBtn.className = 'btn-text';
                            adminBtn.innerHTML = '<i class="fas fa-shield-halved"></i> Admin';
                            adminBtn.onclick = () => location.href = 'admin.html';
                            adminBtn.style.color = '#ff4d4d';
                            headerRight.insertBefore(adminBtn, headerRight.firstChild);
                        }
                    }
                }
            }
        }

        // Check if user is already logged in on page load
        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('vitox_user');
            if (savedUser) {
                updateLoginUI(JSON.parse(savedUser));
            }

            // Hide Shimmer and Show Content after 1 second (Simulates real loading)
            setTimeout(() => {
                const shimmer = document.getElementById('loading-shimmer');
                const grid = document.querySelector('.video-grid');
                if (shimmer) shimmer.style.display = 'none';
                if (grid) grid.style.display = 'grid';
            }, 1200);

            // Category Chip Interaction
            const chips = document.querySelectorAll('.chip');
            chips.forEach(chip => {
                chip.onclick = () => {
                    chips.forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                };
            });
        });

        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        function logout() {
            localStorage.removeItem('vitox_user');
            location.reload();
        }
    </script>
</body>

</html>